import{ipcRenderer as s}from"electron";var i={GET:(e)=>`store:${e}:get`,SET:(e)=>`store:${e}:set`,ON_CHANGE:(e)=>`store:${e}:changed`};class n{name;state;listeners=new Set;readyPromise;channelChange;handleParamsChange=(e,t)=>{this.state=t,this.notify()};constructor(e){this.name=e;this.channelChange=i.ON_CHANGE(e),s.on(this.channelChange,this.handleParamsChange),this.readyPromise=s.invoke(i.GET(e)).then((t)=>{if(this.state===void 0)this.state=t,this.notify();return this.state})}ready(){return this.readyPromise}get(){if(this.state===void 0)throw Error(`Store "${this.name}" not hydrated`);return this.state}async set(e){this.state=e,this.notify();try{await s.invoke(i.SET(this.name),e)}catch(t){console.error(`Store "${this.name}" sync failed`,t),this.state=await s.invoke(i.GET(this.name)),this.notify()}}subscribe(e){if(this.listeners.add(e),this.state!==void 0)e(this.state);return()=>this.listeners.delete(e)}notify(){if(this.state===void 0)return;for(let e of this.listeners)e(this.state)}dispose(){s.removeListener(this.channelChange,this.handleParamsChange),this.listeners.clear()}}function h(e){return new n(e)}export{h as createClient,n as StoreClient};

//# debugId=F07A41A437D898BA64756E2164756E21
